{"_path":"/blog/hasura-how-to-pass-dyanamic-expression","_dir":"blog","_draft":false,"_partial":false,"_locale":"","title":"Hasura: How to pass a dynamic expression/condition using GraphQl","description":"How to pass dynamic conditions/expressions to Hasrua GraphQl queries","date":"Tuesday, July 30, 2024","body":{"type":"root","children":[{"type":"element","tag":"h1","props":{"id":"hasura-how-to-pass-a-dynamic-expressioncondition-using-graphql"},"children":[{"type":"text","value":"Hasura: How to pass a dynamic expression/condition using GraphQl"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We had a case in our app where we wanted to give the user ability filter questions by \"answered\" or \"not_answered\" or \"all\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We have a flag in the questions table called \"is_answered\", it's pretty easy to use it like this"}]},{"type":"element","tag":"pre","props":{"className":"language-gql shiki shiki-themes github-light github-dark monokai","code":"query getQuestions($subjectId: bigint, $is_answered: Boolean = true) {\n  questions(\n    where: {\n      subject_id: { _eq: $subjectId }\n      is_answered: { _eq: $is_answered }\n    }\n  ) {\n    title\n  }\n}\n","language":"gql","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"query getQuestions($subjectId: bigint, $is_answered: Boolean = true) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  questions(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    where: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      subject_id: { _eq: $subjectId }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"      is_answered: { _eq: $is_answered }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    title\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"by passing "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$is_answered"}]},{"type":"text","value":" we can retrieve either the answered or not answered questions. But what if want to retrieve both?"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We thought we can just by passing "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"null"}]},{"type":"text","value":" or "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"undefined"}]},{"type":"text","value":" instrad of a boolean then Hasura will understand and will ignore the whole expression and retieve both, but Hasura throws an error if you do this."}]},{"type":"element","tag":"h2","props":{"id":"solutions-we-have"},"children":[{"type":"text","value":"Solutions we have:"}]},{"type":"element","tag":"h4","props":{"id":"solution-1-multiple-queries"},"children":[{"type":"text","value":"Solution (1): Multiple queries"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"You can have multiple queries, one that has the "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$is_answered"}]},{"type":"text","value":" parameter, and the other doesn't have it.. this might be okay for small queries or edge cases only, but if you have big queries and you do this, it will be hard to maintain those queries."}]},{"type":"element","tag":"h4","props":{"id":"solution-2-use-boolean-expression-andexp"},"children":[{"type":"text","value":"Solution (2): Use boolean expression "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"AndExp"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hasura has several "},{"type":"element","tag":"a","props":{"href":"https://hasura.io/docs/latest/api-reference/graphql-api/query/#andexp","rel":["nofollow"]},"children":[{"type":"text","value":"boolean expressions"}]},{"type":"text","value":" that you can use them."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"One of them is "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"AndExp"}]},{"type":"text","value":" we used it to fix this issue by passing the query a dynamic expression as bellow:"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We updated our query to be:"}]},{"type":"element","tag":"pre","props":{"className":"language-gql shiki shiki-themes github-light github-dark monokai","code":"query getQuestions(\n  $subjectId: bigint\n  $isAnsweredExpression: questions_bool_exp!\n) {\n  questions(\n    where: { subject_id: { _eq: $subjectId }, _and: [$isAnsweredExpression] }\n  ) {\n    title\n  }\n}\n","language":"gql","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"query getQuestions(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  $subjectId: bigint\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  $isAnsweredExpression: questions_bool_exp!\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":") {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  questions(\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    where: { subject_id: { _eq: $subjectId }, _and: [$isAnsweredExpression] }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  ) {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"    title\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":10},"children":[{"type":"element","tag":"span","props":{},"children":[{"type":"text","value":"}\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"We changed "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$is_answered"}]},{"type":"text","value":" param to "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"$isAnsweredExpression"}]},{"type":"text","value":" with type: "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"questions_bool_exp!"}]},{"type":"text","value":" where "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"questions"}]},{"type":"text","value":" is our table name, you need to update it"}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Now this is how passed the expression to the query:"}]},{"type":"element","tag":"pre","props":{"className":"language-js shiki shiki-themes github-light github-dark monokai","code":"await client.query({\n  fetchPolicy: \"no-cache\",\n  query,\n  variables: {\n    subjectId: 1,\n    isAnsweredExpression:\n      display == \"all\" ? {} : { is_answered: { _eq: display == \"answered\" } }\n  }\n});\n","language":"js","meta":"","style":""},"children":[{"type":"element","tag":"code","props":{"__ignoreMap":""},"children":[{"type":"element","tag":"span","props":{"class":"line","line":1},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"await"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" client."}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#6F42C1;--shiki-dark:#B392F0;--shiki-sepia:#A6E22E"},"children":[{"type":"text","value":"query"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"({\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":2},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  fetchPolicy: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":"\"no-cache\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":3},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  query,\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":4},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  variables: {\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":5},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    subjectId: "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#005CC5;--shiki-dark:#79B8FF;--shiki-sepia:#AE81FF"},"children":[{"type":"text","value":"1"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":",\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":6},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"    isAnsweredExpression:\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":7},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"      display "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" \"all\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":" ?"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" {} "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":":"}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" { is_answered: { _eq: display "}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#D73A49;--shiki-dark:#F97583;--shiki-sepia:#F92672"},"children":[{"type":"text","value":"=="}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#032F62;--shiki-dark:#9ECBFF;--shiki-sepia:#E6DB74"},"children":[{"type":"text","value":" \"answered\""}]},{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":" } }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":8},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"  }\n"}]}]},{"type":"element","tag":"span","props":{"class":"line","line":9},"children":[{"type":"element","tag":"span","props":{"style":"--shiki-default:#24292E;--shiki-dark:#E1E4E8;--shiki-sepia:#F8F8F2"},"children":[{"type":"text","value":"});\n"}]}]}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"display"}]},{"type":"text","value":" is the selected option by user it can be \"all\", \"answered\" or \"not_answered\"."}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"if the user chooses \"all\", then we just need send "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"{}"}]},{"type":"text","value":" and Hasura will ignore your expression and you will get both answered and not answered questions, if the user chooses \"answered\" or \"not_answered\", then you need to send the full expression like this "},{"type":"element","tag":"code","props":{"className":[]},"children":[{"type":"text","value":"{ is_answered: { _eq: true }"}]}]},{"type":"element","tag":"p","props":{},"children":[{"type":"text","value":"Hope this fixes your issue!"}]},{"type":"element","tag":"br","props":{},"children":[]},{"type":"element","tag":"style","props":{},"children":[{"type":"text","value":"html .default .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .shiki span {color: var(--shiki-default);background: var(--shiki-default-bg);font-style: var(--shiki-default-font-style);font-weight: var(--shiki-default-font-weight);text-decoration: var(--shiki-default-text-decoration);}html .dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html.dark .shiki span {color: var(--shiki-dark);background: var(--shiki-dark-bg);font-style: var(--shiki-dark-font-style);font-weight: var(--shiki-dark-font-weight);text-decoration: var(--shiki-dark-text-decoration);}html .sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}html.sepia .shiki span {color: var(--shiki-sepia);background: var(--shiki-sepia-bg);font-style: var(--shiki-sepia-font-style);font-weight: var(--shiki-sepia-font-weight);text-decoration: var(--shiki-sepia-text-decoration);}"}]}],"toc":{"title":"","searchDepth":2,"depth":2,"links":[{"id":"solutions-we-have","depth":2,"text":"Solutions we have:"}]}},"_type":"markdown","_id":"content:blog:hasura-how-to-pass-dyanamic-expression.md","_source":"content","_file":"blog/hasura-how-to-pass-dyanamic-expression.md","_stem":"blog/hasura-how-to-pass-dyanamic-expression","_extension":"md"}